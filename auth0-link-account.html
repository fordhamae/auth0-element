<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="auth0-lock.html">

<dom-module id="auth0-link-account">

  <template>
  </template>

  <script>
    class Auth0LinkAccount extends Polymer.Element {
      static get is() {return 'auth0-link-account'}
      static get properties() {
        return {
          connection: {
          type: String,
          notify: true
          },
          clientId: {
            type: String
          },
          domain: {
            type: String
          },
          options: {
            type: Object
          }
        }
      }

      static get observers() {
        return [
          '_initAccountLinking(connection)'
        ]
      }

      _initAccountLinking(connection) {
        if(!connection) {return}

        var options = Object.assign({}, this.options);
        options.allowedConnections = [connection];
        localStorage.setItem('auth0:link-account', connection);
        var lock = new Auth0Lock(this.clientId, this.domain, options);
        lock.on('hide', function () {
          localStorage.removeItem('auth0:link-account');
          this.connection = null;
        }.bind(this));
        lock.show();
      }
    }

    customElements.define(Auth0LinkAccount.is, Auth0LinkAccount);
  </script>
</dom-module>
